#  Configure AWS STS Credentials

## Configure AWS STS Credentials

### 6. Configure AWS STS Credentials

This section guides you through creating AWS Security Token Service (STS) IAM roles and credential manifests using the `ccoctl` tool.

### 6.1. Objective

The primary objective of this step is to create AWS STS IAM roles and credential manifests using `ccoctl`. This process is crucial for establishing secure communication between your OpenShift cluster and AWS services.

### 6.2. Steps

1. **Create Working Directory**

   Begin by creating a working directory for the STS configuration:

   ```bash
   cd /home/ec2-user
   mkdir -p sts
   cd sts
   ```

2. **Delete Existing STS Configuration**

   Remove any existing STS configurations to ensure a clean setup. Ignore errors if no configurations are found:

   ```bash
   ccoctl aws delete --name ${STS_SUFFIX} --region ${AWS_REGION}
   ```

3. **Retrieve the Release Image**

   Fetch the OpenShift release image that will be used for extracting credentials requests:

   ```bash
   RELEASE_IMAGE=$(openshift-install version | awk '/release image/ {print $3}')
   echo $RELEASE_IMAGE
   ```

4. **Extract CredentialsRequests**

   Extract the CredentialsRequests from the release image:

   ```bash
   mkdir -p credrequests
   oc adm release extract --credentials-requests --cloud=aws --to=credrequests $RELEASE_IMAGE
   ```

5. **Create STS Resources**

   Use `ccoctl` to create the necessary STS resources based on the extracted credentials requests:

   ```bash
   ccoctl aws create-all --credentials-requests-dir credrequests --name ${STS_SUFFIX} --region ${AWS_REGION} --create-private-s3-bucket
   ```

6. **Verify Directory Contents**

   Ensure that the STS configuration files have been correctly generated by listing the contents of the `sts` directory:

   ```bash
   ls -R /home/ec2-user/sts
   ```

By following these steps, you will have successfully configured AWS STS credentials, enabling secure access to AWS services from your OpenShift cluster. This setup is essential for managing identities and authorizing access to resources in a secure manner.